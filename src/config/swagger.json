{
    "openapi": "3.0.0",
    "info": {
        "title": "Node.js Backend API",
        "version": "1.0.0",
        "description": "API documentation cho Node.js Backend với TypeScript, Express và MongoDB",
        "contact": {
            "name": "API Support",
            "email": "support@example.com"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        }
    },
    "servers": [
        {
            "url": "/",
            "description": "Production (patched at runtime)"
        }
    ],
    "components": {
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "scheme": "bearer",
                "bearerFormat": "JWT"
            }
        },
        "schemas": {
            "User": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "username": {
                        "type": "string"
                    },
                    "role": {
                        "type": "string",
                        "enum": [
                            "user",
                            "staff",
                            "admin"
                        ]
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "updatedAt": {
                        "type": "string",
                        "format": "date-time"
                    }
                }
            },
            "CreateUserRequest": {
                "type": "object",
                "required": [
                    "username",
                    "password"
                ],
                "properties": {
                    "username": {
                        "type": "string",
                        "example": "user123"
                    },
                    "password": {
                        "type": "string",
                        "example": "password123"
                    }
                }
            },
            "LoginRequest": {
                "type": "object",
                "required": [
                    "username",
                    "password"
                ],
                "properties": {
                    "username": {
                        "type": "string",
                        "example": "user123"
                    },
                    "password": {
                        "type": "string",
                        "example": "password123"
                    }
                }
            },
            "LoginResponse": {
                "type": "object",
                "properties": {
                    "success": {
                        "type": "boolean",
                        "example": true
                    },
                    "message": {
                        "type": "string",
                        "example": "Đăng nhập thành công"
                    },
                    "data": {
                        "type": "object",
                        "properties": {
                            "user": {
                                "$ref": "#/components/schemas/User"
                            },
                            "token": {
                                "type": "string",
                                "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                            }
                        }
                    }
                }
            },
            "UpdateProfileRequest": {
                "type": "object",
                "required": [
                    "newUsername"
                ],
                "properties": {
                    "newUsername": {
                        "type": "string",
                        "example": "newuser123"
                    }
                }
            },
            "ApiResponse": {
                "type": "object",
                "properties": {
                    "success": {
                        "type": "boolean"
                    },
                    "message": {
                        "type": "string"
                    },
                    "data": {
                        "type": "object"
                    }
                }
            },
            "ErrorResponse": {
                "type": "object",
                "properties": {
                    "success": {
                        "type": "boolean",
                        "example": false
                    },
                    "error": {
                        "type": "string",
                        "example": "BadRequest"
                    },
                    "message": {
                        "type": "string",
                        "example": "Thông báo lỗi chi tiết"
                    }
                }
            },
            "ChargingPortCreate": {
                "type": "object",
                "required": [
                    "type",
                    "powerKw",
                    "speed",
                    "price"
                ],
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": [
                            "DC",
                            "Ultra",
                            "AC"
                        ]
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "available",
                            "in_use"
                        ],
                        "default": "available"
                    },
                    "powerKw": {
                        "type": "number",
                        "example": 60
                    },
                    "speed": {
                        "type": "string",
                        "enum": [
                            "fast",
                            "slow",
                            "super_fast"
                        ]
                    },
                    "price": {
                        "type": "number",
                        "example": 3500
                    }
                }
            },
            "ChargingPortCreateWithStation": {
                "allOf": [
                    {
                        "$ref": "#/components/schemas/ChargingPortCreate"
                    },
                    {
                        "type": "object",
                        "required": [
                            "stationId"
                        ],
                        "properties": {
                            "stationId": {
                                "type": "string",
                                "description": "Station to attach this port to."
                            }
                        }
                    }
                ]
            },
            "ChargingPortUpdate": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": [
                            "DC",
                            "Ultra",
                            "AC"
                        ]
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "available",
                            "in_use"
                        ]
                    },
                    "powerKw": {
                        "type": "number"
                    },
                    "speed": {
                        "type": "string",
                        "enum": [
                            "fast",
                            "slow",
                            "super_fast"
                        ]
                    },
                    "price": {
                        "type": "number"
                    }
                }
            },
            "ChargingSlotCreate": {
                "type": "object",
                "properties": {
                    "order": {
                        "type": "integer",
                        "minimum": 1,
                        "description": "Slot order within the port (unique per port). If omitted, next order is auto-assigned.",
                        "example": 1
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "available",
                            "booked",
                            "in_use"
                        ],
                        "default": "available"
                    },
                    "nextAvailableAt": {
                        "type": "string",
                        "format": "date-time",
                        "nullable": true,
                        "description": "If status is 'available', this is forced to null."
                    }
                }
            },
            "ChargingSlotUpdate": {
                "type": "object",
                "properties": {
                    "order": {
                        "type": "integer",
                        "minimum": 1
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "available",
                            "booked",
                            "in_use"
                        ]
                    },
                    "nextAvailableAt": {
                        "type": "string",
                        "format": "date-time",
                        "nullable": true
                    }
                }
            },
            "PricingEstimateRequest": {
                "type": "object",
                "required": [
                    "portId",
                    "startAt",
                    "endAt"
                ],
                "properties": {
                    "portId": {
                        "type": "string",
                        "description": "ID của cổng sạc",
                        "example": "6701f5b1a7e5e7c8f0a12345"
                    },
                    "startAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "Thời điểm bắt đầu (ISO 8601, UTC)",
                        "example": "2025-10-01T10:00:00Z"
                    },
                    "endAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "Thời điểm kết thúc (ISO 8601, UTC)",
                        "example": "2025-10-01T12:00:00Z"
                    },
                    "assumePowerKw": {
                        "type": "number",
                        "description": "Công suất giả định (kW) nếu cổng sạc chưa có dữ liệu công suất. Mặc định 1 kW (để khớp ví dụ).",
                        "example": 1
                    }
                }
            },
            "PricingEstimateResponse": {
                "type": "object",
                "properties": {
                    "success": {
                        "type": "boolean",
                        "example": true
                    },
                    "message": {
                        "type": "string",
                        "example": "OK"
                    },
                    "data": {
                        "type": "object",
                        "properties": {
                            "portId": {
                                "type": "string"
                            },
                            "portType": {
                                "type": "string",
                                "enum": [
                                    "AC",
                                    "DC",
                                    "DC Ultra"
                                ]
                            },
                            "durationHours": {
                                "type": "number",
                                "example": 2
                            },
                            "powerKwUsed": {
                                "type": "number",
                                "example": 1
                            },
                            "bookingRatePerHour": {
                                "type": "number",
                                "example": 10000
                            },
                            "energyPricePerKwh": {
                                "type": "number",
                                "example": 3858
                            },
                            "energyKwh": {
                                "type": "number",
                                "example": 2
                            },
                            "bookingCost": {
                                "type": "number",
                                "example": 20000
                            },
                            "energyCost": {
                                "type": "number",
                                "example": 7716
                            },
                            "total": {
                                "type": "number",
                                "example": 27716
                            },
                            "currency": {
                                "type": "string",
                                "example": "VND"
                            }
                        }
                    }
                }
            },
            "VehicleCreate": {
                "type": "object",
                "required": [
                    "plateNumber"
                ],
                "properties": {
                    "owner": {
                        "type": "string",
                        "description": "User ID (ignored for role=user; server uses your userId)"
                    },
                    "plateNumber": {
                        "type": "string",
                        "example": "51H-123.45"
                    },
                    "make": {
                        "type": "string",
                        "example": "VinFast"
                    },
                    "model": {
                        "type": "string",
                        "example": "VF8"
                    },
                    "year": {
                        "type": "integer",
                        "example": 2023
                    },
                    "color": {
                        "type": "string",
                        "example": "White"
                    },
                    "vin": {
                        "type": "string",
                        "example": "WVWAA71K08W201030"
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "car",
                            "motorbike",
                            "scooter",
                            "truck",
                            "other"
                        ],
                        "example": "car"
                    },
                    "batteryCapacityKwh": {
                        "type": "number",
                        "example": 82
                    },
                    "connectorType": {
                        "type": "string",
                        "example": "DC"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "active",
                            "inactive"
                        ],
                        "example": "active"
                    }
                }
            },
            "VehicleUpdate": {
                "type": "object",
                "properties": {
                    "plateNumber": {
                        "type": "string"
                    },
                    "make": {
                        "type": "string"
                    },
                    "model": {
                        "type": "string"
                    },
                    "year": {
                        "type": "integer"
                    },
                    "color": {
                        "type": "string"
                    },
                    "vin": {
                        "type": "string",
                        "nullable": true
                    },
                    "type": {
                        "type": "string",
                        "enum": [
                            "car",
                            "motorbike",
                            "scooter",
                            "truck",
                            "other"
                        ]
                    },
                    "batteryCapacityKwh": {
                        "type": "number",
                        "nullable": true
                    },
                    "connectorType": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "active",
                            "inactive"
                        ]
                    }
                }
            }
        }
    },
    "tags": [
        {
            "name": "Authentication",
            "description": "API liên quan đến xác thực người dùng"
        },
        {
            "name": "Users",
            "description": "API quản lý người dùng"
        },
        {
            "name": "System",
            "description": "API hệ thống"
        },
        {
            "name": "ChargingStations",
            "description": "CRUD for EV charging stations"
        },
        {
            "name": "ChargingPorts",
            "description": "CRUD for EV charging ports (stationId only needed on create)"
        },
        {
            "name": "ChargingSlots",
            "description": "CRUD for slots (portId for collection, slotId for item ops)"
        },
        {
            "name": "Pricing",
            "description": "Tính chi phí đặt lịch và tiền điện sạc theo cổng sạc"
        },
        {
            "name": "Reservations",
            "description": "Booking EV charging slots by time ranges (per vehicle)"
        },
        {
            "name": "Subscriptions",
            "description": "Quản lý gói đăng ký (Basic, Standard, Premium)"
        },
        {
            "name": "SubscriptionPlans",
            "description": "Quản lý các gói subscription (Basic, Standard, Premium)"
        },
        {
            "name": "Transactions",
            "description": "Quản lý giao dịch"
        },
        {
            "name": "Vehicles",
            "description": "CRUD for user vehicles"
        },
        {
            "name": "VNPay",
            "description": "Tích hợp cổng thanh toán VNPay"
        }
    ],
    "paths": {
        "/stations": {
            "post": {
                "tags": [
                    "ChargingStations"
                ],
                "summary": "Create charging station (with optional ports)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "name",
                                    "longitude",
                                    "latitude"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "example": "Station A"
                                    },
                                    "longitude": {
                                        "type": "number",
                                        "example": 106.700981
                                    },
                                    "latitude": {
                                        "type": "number",
                                        "example": 10.776889
                                    },
                                    "status": {
                                        "type": "string",
                                        "enum": [
                                            "active",
                                            "inactive",
                                            "maintenance"
                                        ],
                                        "example": "active"
                                    },
                                    "address": {
                                        "type": "string",
                                        "example": "01 Nguyễn Huệ, Q1, TP.HCM"
                                    },
                                    "provider": {
                                        "type": "string",
                                        "example": "VinFast"
                                    },
                                    "ports": {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/components/schemas/ChargingPortCreate"
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Unauthorized"
                    }
                }
            },
            "get": {
                "tags": [
                    "ChargingStations"
                ],
                "summary": "List charging stations (filter/pagination, ports populated by default) - Public access",
                "parameters": [
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "active",
                                "inactive",
                                "maintenance"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "name",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "address",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "provider",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "example": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "example": 120
                        }
                    },
                    {
                        "in": "query",
                        "name": "includePorts",
                        "schema": {
                            "type": "boolean",
                            "example": true
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                }
            }
        },
        "/stations/{id}": {
            "get": {
                "tags": [
                    "ChargingStations"
                ],
                "summary": "Get charging station by id (ports populated by default) - Public access",
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "includePorts",
                        "schema": {
                            "type": "boolean",
                            "example": true
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "404": {
                        "description": "Not found"
                    }
                }
            },
            "put": {
                "tags": [
                    "ChargingStations"
                ],
                "summary": "Update charging station + sync ports",
                "description": "- Send `ports` with items that include `id` to update existing ports, and items without `id` to create new.\n- By default, ports not included will be **deleted** (`removeMissingPorts=true`). Set `removeMissingPorts=false` to keep them.\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    },
                                    "longitude": {
                                        "type": "number"
                                    },
                                    "latitude": {
                                        "type": "number"
                                    },
                                    "status": {
                                        "type": "string",
                                        "enum": [
                                            "active",
                                            "inactive",
                                            "maintenance"
                                        ]
                                    },
                                    "address": {
                                        "type": "string"
                                    },
                                    "provider": {
                                        "type": "string"
                                    },
                                    "ports": {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/components/schemas/ChargingPortCreate"
                                        }
                                    },
                                    "removeMissingPorts": {
                                        "type": "boolean",
                                        "default": true
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Updated"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "404": {
                        "description": "Not found"
                    }
                }
            },
            "delete": {
                "tags": [
                    "ChargingStations"
                ],
                "summary": "Soft delete a charging station (mark as inactive)",
                "description": "Set `status = inactive`. Data is kept; ports remain unchanged.",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Marked as inactive"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "404": {
                        "description": "Not found"
                    }
                }
            }
        },
        "/stations/ports": {
            "post": {
                "tags": [
                    "ChargingPorts"
                ],
                "summary": "Create a charging port (attach to station)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ChargingPortCreateWithStation"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "404": {
                        "description": "Station not found"
                    }
                }
            }
        },
        "/stations/ports/{portId}": {
            "get": {
                "tags": [
                    "ChargingPorts"
                ],
                "summary": "Get a specific charging port - Public access",
                "parameters": [
                    {
                        "in": "path",
                        "name": "portId",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "404": {
                        "description": "Not found"
                    }
                }
            },
            "put": {
                "tags": [
                    "ChargingPorts"
                ],
                "summary": "Update a specific charging port",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "portId",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ChargingPortUpdate"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Updated"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "404": {
                        "description": "Port not found"
                    }
                }
            },
            "delete": {
                "tags": [
                    "ChargingPorts"
                ],
                "summary": "Delete a specific charging port",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "portId",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Deleted"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "404": {
                        "description": "Port not found"
                    }
                }
            }
        },
        "/stations/ports/{portId}/slots": {
            "get": {
                "tags": [
                    "ChargingSlots"
                ],
                "summary": "List charging slots for a specific port - Public access",
                "parameters": [
                    {
                        "in": "path",
                        "name": "portId",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "404": {
                        "description": "Port not found"
                    }
                }
            },
            "post": {
                "tags": [
                    "ChargingSlots"
                ],
                "summary": "Create a charging slot in a port",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "portId",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/ChargingSlotCreate"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "404": {
                        "description": "Port not found"
                    },
                    "409": {
                        "description": "Conflict — slot order already exists"
                    }
                }
            }
        },
        "/stations/slots/{slotId}": {
            "get": {
                "tags": [
                    "ChargingSlots"
                ],
                "summary": "Get a specific charging slot by id - Public access",
                "parameters": [
                    {
                        "in": "path",
                        "name": "slotId",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "404": {
                        "description": "Slot not found"
                    }
                }
            }
        },
        "/pricing/estimate": {
            "post": {
                "tags": [
                    "Pricing"
                ],
                "summary": "Tính chi phí đặt lịch + tiền điện theo cổng sạc",
                "description": "- Đặt lịch (VND/h): **AC=10.000**, **DC=15.000**, **DC Ultra=20.000**  \n- Đơn giá điện: **3.858 VND/kWh**  \n- Năng lượng = `công suất (kW)` × `số giờ`. Nếu không có công suất trên cổng sạc và bạn không truyền `assumePowerKw`, hệ thống mặc định **1 kW** (để khớp ví dụ).\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/PricingEstimateRequest"
                            },
                            "example": {
                                "portId": "6701f5b1a7e5e7c8f0a12345",
                                "startAt": "2025-10-01T10:00:00Z",
                                "endAt": "2025-10-01T12:00:00Z",
                                "assumePowerKw": 1
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/PricingEstimateResponse"
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "InvalidInput"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "404": {
                        "description": "NotFound"
                    }
                }
            }
        },
        "/reservations": {
            "post": {
                "tags": [
                    "Reservations"
                ],
                "summary": "Create a reservation for a vehicle (multiple slots, each with start/end)",
                "description": "Create a reservation **for a specific vehicle** with one or more slot/time ranges.\n- **vehicleId is required** and must belong to the current user (unless admin/staff).\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "vehicleId",
                                    "items"
                                ],
                                "properties": {
                                    "vehicleId": {
                                        "type": "string",
                                        "description": "Vehicle id (must belong to the current user unless admin/staff)"
                                    },
                                    "items": {
                                        "type": "array",
                                        "minItems": 1,
                                        "description": "List of slot/time ranges to book",
                                        "items": {
                                            "type": "object",
                                            "required": [
                                                "slotId",
                                                "startAt",
                                                "endAt"
                                            ],
                                            "properties": {
                                                "slotId": {
                                                    "type": "string",
                                                    "description": "ChargingSlot id"
                                                },
                                                "startAt": {
                                                    "type": "string",
                                                    "format": "date-time",
                                                    "description": "ISO 8601 UTC start time"
                                                },
                                                "endAt": {
                                                    "type": "string",
                                                    "format": "date-time",
                                                    "description": "ISO 8601 UTC end time"
                                                }
                                            }
                                        }
                                    },
                                    "status": {
                                        "type": "string",
                                        "description": "Initial status (use \"pending\" unless business rules allow auto-confirm)",
                                        "enum": [
                                            "pending",
                                            "confirmed"
                                        ]
                                    }
                                }
                            },
                            "example": {
                                "vehicleId": "66f2aaa0123456789abc0123",
                                "items": [
                                    {
                                        "slotId": "64f2abc0123456789abc0123",
                                        "startAt": "2025-10-01T10:00:00Z",
                                        "endAt": "2025-10-01T11:00:00Z"
                                    },
                                    {
                                        "slotId": "64f3def0123456789def0456",
                                        "startAt": "2025-10-02T09:00:00Z",
                                        "endAt": "2025-10-02T10:30:00Z"
                                    }
                                ],
                                "status": "pending"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Reservation created"
                    },
                    "400": {
                        "description": "Invalid input"
                    },
                    "404": {
                        "description": "Vehicle/Slot not found"
                    },
                    "409": {
                        "description": "Time overlap conflict"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            },
            "get": {
                "tags": [
                    "Reservations"
                ],
                "summary": "List my reservations (by my vehicles or a specific vehicle)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "vehicleId",
                        "schema": {
                            "type": "string"
                        },
                        "description": "If provided, filter only this vehicle. Otherwise list all reservations for vehicles owned by the user."
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "pending",
                                "confirmed",
                                "cancelled",
                                "completed"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 100
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                }
            }
        },
        "/reservations/{id}": {
            "get": {
                "tags": [
                    "Reservations"
                ],
                "summary": "Get reservation by id",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "403": {
                        "description": "Forbidden for non-owners"
                    },
                    "404": {
                        "description": "NotFound"
                    }
                }
            }
        },
        "/reservations/{id}/cancel": {
            "patch": {
                "tags": [
                    "Reservations"
                ],
                "summary": "Cancel a reservation (owner or admin/staff)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Reservation cancelled"
                    },
                    "400": {
                        "description": "InvalidInput"
                    },
                    "403": {
                        "description": "Forbidden"
                    },
                    "404": {
                        "description": "NotFound"
                    }
                }
            }
        },
        "/reservations/qr-check": {
            "post": {
                "tags": [
                    "Reservations"
                ],
                "summary": "Check-in reservation using QR code (Staff/Admin only)",
                "description": "Staff hoặc Admin scan QR code để check-in reservation.\n- Chỉ reservation có status = \"confirmed\" mới được check-in\n- Nếu qrCheck = false và status = confirmed → update qrCheck = true, return success\n- Nếu qrCheck = true → return \"QR code đã được sử dụng\"\n- Nếu status ≠ confirmed → return \"Reservation chưa thanh toán\"\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "reservationId"
                                ],
                                "properties": {
                                    "reservationId": {
                                        "type": "string",
                                        "description": "ID của reservation cần check-in",
                                        "example": "670abc123def456ghi789jkl"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Check-in thành công hoặc QR đã được sử dụng",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean",
                                            "example": true
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Check-in thành công"
                                        },
                                        "data": {
                                            "type": "object",
                                            "properties": {
                                                "reservationId": {
                                                    "type": "string"
                                                },
                                                "status": {
                                                    "type": "string",
                                                    "example": "confirmed"
                                                },
                                                "qrCheck": {
                                                    "type": "boolean",
                                                    "example": true
                                                },
                                                "checkedAt": {
                                                    "type": "string",
                                                    "format": "date-time"
                                                },
                                                "checkedBy": {
                                                    "type": "object",
                                                    "properties": {
                                                        "userId": {
                                                            "type": "string"
                                                        },
                                                        "role": {
                                                            "type": "string",
                                                            "example": "staff"
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Reservation chưa thanh toán hoặc dữ liệu không hợp lệ"
                    },
                    "403": {
                        "description": "Không có quyền (chỉ staff/admin)"
                    },
                    "404": {
                        "description": "Không tìm thấy reservation"
                    }
                }
            }
        },
        "/subscriptions/my-subscriptions": {
            "get": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Lấy danh sách subscriptions của user hiện tại",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy danh sách thành công"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    }
                }
            }
        },
        "/subscriptions/current-active": {
            "get": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Lấy subscription đang hoạt động (current_active) của user hiện tại",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy subscription thành công"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    },
                    "404": {
                        "description": "Không có subscription đang hoạt động"
                    }
                }
            }
        },
        "/subscriptions": {
            "post": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Tạo subscription mới cho user bằng planId (Admin only)",
                "description": "Admin tạo subscription mới cho user bằng cách chọn planId. \nStatus sẽ là \"pending\" cho đến khi thanh toán thành công.\n\n**Lấy danh sách plans:** GET /subscription-plans\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "userId",
                                    "planId"
                                ],
                                "properties": {
                                    "userId": {
                                        "type": "string",
                                        "example": "60d5ec49f1b2c72b8c8e4f1a",
                                        "description": "ID của user cần tạo subscription"
                                    },
                                    "planId": {
                                        "type": "string",
                                        "example": "670abc123def456",
                                        "description": "ID của subscription plan (lấy từ GET /subscription-plans)"
                                    },
                                    "autoRenew": {
                                        "type": "boolean",
                                        "example": false,
                                        "description": "Tự động gia hạn khi hết hạn"
                                    },
                                    "customPrice": {
                                        "type": "number",
                                        "example": 150000,
                                        "description": "Giá custom (optional)"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Tạo subscription thành công"
                    },
                    "400": {
                        "description": "Dữ liệu không hợp lệ"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    },
                    "403": {
                        "description": "Không có quyền"
                    }
                }
            },
            "get": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Lấy tất cả subscriptions (Tất cả user đều có thể xem)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "type",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "basic",
                                "standard",
                                "premium"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "duration",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "1_month",
                                "6_months",
                                "12_months"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "current_active",
                                "active",
                                "expired",
                                "cancelled",
                                "pending"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "userId",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "default": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "default": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy danh sách thành công"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    }
                }
            }
        },
        "/subscriptions/upgrade": {
            "post": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Nâng cấp subscription bằng planId (từ gói thấp lên gói cao hơn)",
                "description": "User nâng cấp subscription hiện tại bằng cách chọn planId mới.\n- Subscription cũ chuyển từ \"current_active\" -> \"active\"\n- Subscription mới tạo với status \"pending\"\n- Sau khi thanh toán thành công, subscription mới -> \"current_active\"\n\n**Lấy danh sách plans:** GET /subscription-plans\n\n**Điều kiện nâng cấp:**\n- Type cao hơn (basic -> standard -> premium)\n- Duration dài hơn (1_month -> 6_months -> 12_months)\n- Hoặc cả hai\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "planId"
                                ],
                                "properties": {
                                    "planId": {
                                        "type": "string",
                                        "example": "670abc123def456",
                                        "description": "ID của subscription plan mới (lấy từ GET /subscription-plans)"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Nâng cấp subscription thành công"
                    },
                    "400": {
                        "description": "Gói mới không cao hơn gói hiện tại"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    }
                }
            }
        },
        "/subscriptions/{id}": {
            "get": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Lấy chi tiết subscription",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy subscription thành công"
                    },
                    "403": {
                        "description": "Không có quyền xem"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            },
            "put": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Cập nhật subscription (admin only)",
                "description": "Admin cập nhật thông tin subscription",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "status": {
                                        "type": "string",
                                        "enum": [
                                            "current_active",
                                            "active",
                                            "expired",
                                            "cancelled",
                                            "pending"
                                        ]
                                    },
                                    "autoRenew": {
                                        "type": "boolean"
                                    },
                                    "endDate": {
                                        "type": "string",
                                        "format": "date-time"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Cập nhật thành công"
                    },
                    "403": {
                        "description": "Không có quyền"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            },
            "delete": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Xóa subscription (admin only)",
                "description": "Admin xóa subscription (soft delete - chuyển về cancelled)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Xóa thành công"
                    },
                    "403": {
                        "description": "Không có quyền"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            }
        },
        "/subscriptions/payment": {
            "post": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Tạo URL thanh toán VNPay cho subscription bằng planId",
                "description": "User chọn subscription plan và tạo payment URL.\nAPI sẽ tự động tạo subscription (status: pending) cho user và trả về payment URL + subscriptionId.\n\n**Flow:**\n1. User xem danh sách plans (GET /subscription-plans)\n2. User chọn plan và gọi API này với planId\n3. API tự động tạo subscription pending cho user\n4. API trả về URL thanh toán VNPay + subscriptionId\n5. User redirect đến VNPay để thanh toán\n6. Sau khi VNPay return, gọi check-payment-status với subscriptionId\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "planId"
                                ],
                                "properties": {
                                    "planId": {
                                        "type": "string",
                                        "example": "670abc123def456",
                                        "description": "ID của subscription plan (lấy từ GET /subscription-plans)"
                                    },
                                    "locale": {
                                        "type": "string",
                                        "enum": [
                                            "vn",
                                            "en"
                                        ],
                                        "example": "vn"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Tạo URL thanh toán thành công"
                    },
                    "400": {
                        "description": "Plan không hợp lệ hoặc không active"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    },
                    "404": {
                        "description": "Không tìm thấy plan"
                    }
                }
            }
        },
        "/subscriptions/check-payment-status": {
            "post": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Kiểm tra trạng thái thanh toán subscription từ VNPay (Tất cả user)",
                "description": "Sau khi VNPay return, gọi API này với subscriptionId và VNPay return data\nđể kiểm tra trạng thái thanh toán và activate subscription.\n\n**Bất kỳ authenticated user nào cũng có thể check payment nếu có subscriptionId.**\n\n**Flow:**\n1. User thanh toán xong, VNPay redirect về với query params\n2. Frontend gọi API này với subscriptionId + VNPay query params\n3. API verify signature, cập nhật transaction, activate subscription\n4. Trả về trạng thái chi tiết\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "subscriptionId"
                                ],
                                "properties": {
                                    "subscriptionId": {
                                        "type": "string",
                                        "example": "670def789abc123",
                                        "description": "ID của subscription (lấy từ response payment API)"
                                    },
                                    "vnp_Amount": {
                                        "type": "string",
                                        "example": "299900000"
                                    },
                                    "vnp_BankCode": {
                                        "type": "string",
                                        "example": "NCB"
                                    },
                                    "vnp_BankTranNo": {
                                        "type": "string"
                                    },
                                    "vnp_CardType": {
                                        "type": "string",
                                        "example": "ATM"
                                    },
                                    "vnp_OrderInfo": {
                                        "type": "string"
                                    },
                                    "vnp_PayDate": {
                                        "type": "string",
                                        "example": "20251012100000"
                                    },
                                    "vnp_ResponseCode": {
                                        "type": "string",
                                        "example": "00"
                                    },
                                    "vnp_TmnCode": {
                                        "type": "string"
                                    },
                                    "vnp_TransactionNo": {
                                        "type": "string"
                                    },
                                    "vnp_TransactionStatus": {
                                        "type": "string",
                                        "example": "00"
                                    },
                                    "vnp_TxnRef": {
                                        "type": "string"
                                    },
                                    "vnp_SecureHash": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Kiểm tra thành công"
                    },
                    "400": {
                        "description": "Dữ liệu không hợp lệ hoặc signature sai"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    },
                    "403": {
                        "description": "Không có quyền"
                    },
                    "404": {
                        "description": "Không tìm thấy subscription"
                    }
                }
            }
        },
        "/subscriptions/{id}/cancel": {
            "post": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Hủy subscription (vẫn dùng được đến hết thời hạn)",
                "description": "User có thể hủy subscription active của mình.\n\n**Sau khi cancel:**\n- Subscription vẫn giữ nguyên status (current_active/active)\n- User vẫn sử dụng được TẤT CẢ tính năng đến hết endDate\n- autoRenew tự động set thành false\n- Sau endDate, subscription sẽ chuyển sang \"cancelled\"\n\n**Chỉ cancel được subscription có status: active hoặc current_active**\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        },
                        "description": "ID của subscription cần cancel"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Hủy subscription thành công"
                    },
                    "400": {
                        "description": "Subscription không ở trạng thái cho phép cancel"
                    },
                    "403": {
                        "description": "Không có quyền"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            }
        },
        "/subscriptions/{id}/activate": {
            "post": {
                "tags": [
                    "Subscriptions"
                ],
                "summary": "Kích hoạt subscription (admin only)",
                "description": "Admin kích hoạt subscription sau khi xác nhận thanh toán",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Kích hoạt thành công"
                    },
                    "403": {
                        "description": "Không có quyền"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            }
        },
        "/subscription-plans": {
            "get": {
                "tags": [
                    "SubscriptionPlans"
                ],
                "summary": "Lấy danh sách tất cả subscription plans",
                "description": "Lấy danh sách các gói subscription có sẵn (Basic, Standard, Premium với các thời hạn khác nhau)",
                "parameters": [
                    {
                        "in": "query",
                        "name": "type",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "basic",
                                "standard",
                                "premium"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "duration",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "1_month",
                                "6_months",
                                "12_months"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "isActive",
                        "schema": {
                            "type": "boolean"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy danh sách thành công"
                    }
                }
            },
            "post": {
                "tags": [
                    "SubscriptionPlans"
                ],
                "summary": "Tạo subscription plan mới (admin only)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "name",
                                    "type",
                                    "duration",
                                    "durationDays",
                                    "price",
                                    "features"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "example": "Premium - 12 Tháng"
                                    },
                                    "type": {
                                        "type": "string",
                                        "enum": [
                                            "basic",
                                            "standard",
                                            "premium"
                                        ]
                                    },
                                    "duration": {
                                        "type": "string",
                                        "enum": [
                                            "1_month",
                                            "6_months",
                                            "12_months"
                                        ]
                                    },
                                    "durationDays": {
                                        "type": "number",
                                        "example": 365
                                    },
                                    "price": {
                                        "type": "number",
                                        "example": 2999000
                                    },
                                    "originalPrice": {
                                        "type": "number",
                                        "example": 3588000
                                    },
                                    "features": {
                                        "type": "object",
                                        "properties": {
                                            "maxReservations": {
                                                "type": "number",
                                                "example": -1
                                            },
                                            "maxVehicles": {
                                                "type": "number",
                                                "example": -1
                                            },
                                            "prioritySupport": {
                                                "type": "boolean",
                                                "example": true
                                            },
                                            "discount": {
                                                "type": "number",
                                                "example": 10
                                            }
                                        }
                                    },
                                    "description": {
                                        "type": "string"
                                    },
                                    "isActive": {
                                        "type": "boolean"
                                    },
                                    "displayOrder": {
                                        "type": "number"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Tạo plan thành công"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    },
                    "403": {
                        "description": "Không có quyền"
                    }
                }
            }
        },
        "/subscription-plans/{id}": {
            "get": {
                "tags": [
                    "SubscriptionPlans"
                ],
                "summary": "Lấy chi tiết subscription plan",
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy plan thành công"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            },
            "put": {
                "tags": [
                    "SubscriptionPlans"
                ],
                "summary": "Cập nhật subscription plan (admin only)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    },
                                    "price": {
                                        "type": "number"
                                    },
                                    "originalPrice": {
                                        "type": "number"
                                    },
                                    "features": {
                                        "type": "object"
                                    },
                                    "description": {
                                        "type": "string"
                                    },
                                    "isActive": {
                                        "type": "boolean"
                                    },
                                    "displayOrder": {
                                        "type": "number"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Cập nhật thành công"
                    },
                    "403": {
                        "description": "Không có quyền"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            },
            "delete": {
                "tags": [
                    "SubscriptionPlans"
                ],
                "summary": "Xóa subscription plan (admin only)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Xóa thành công"
                    },
                    "403": {
                        "description": "Không có quyền"
                    },
                    "404": {
                        "description": "Không tìm thấy"
                    }
                }
            }
        },
        "/transactions/my-history": {
            "get": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Lấy lịch sử giao dịch của user hiện tại",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "default": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "default": 10
                        }
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "pending",
                                "processing",
                                "success",
                                "failed",
                                "cancelled",
                                "refunded"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "paymentMethod",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "vnpay",
                                "cash",
                                "other"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "fromDate",
                        "schema": {
                            "type": "string",
                            "format": "date-time"
                        }
                    },
                    {
                        "in": "query",
                        "name": "toDate",
                        "schema": {
                            "type": "string",
                            "format": "date-time"
                        }
                    },
                    {
                        "in": "query",
                        "name": "minAmount",
                        "schema": {
                            "type": "number"
                        }
                    },
                    {
                        "in": "query",
                        "name": "maxAmount",
                        "schema": {
                            "type": "number"
                        }
                    },
                    {
                        "in": "query",
                        "name": "sortBy",
                        "schema": {
                            "type": "string",
                            "default": "createdAt"
                        }
                    },
                    {
                        "in": "query",
                        "name": "sortOrder",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "asc",
                                "desc"
                            ],
                            "default": "desc"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy lịch sử giao dịch thành công"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    }
                }
            }
        },
        "/transactions/my-stats": {
            "get": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Lấy thống kê giao dịch của user hiện tại",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy thống kê thành công"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    }
                }
            }
        },
        "/transactions/my-report": {
            "get": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Lấy báo cáo giao dịch chi tiết của user hiện tại (dạng bảng)",
                "description": "Trả về bảng giao dịch với đầy đủ thông tin:\n- Ngày giao dịch\n- Tên người dùng\n- Số tiền\n- Phương thức thanh toán\n- Trạng thái\n- Lý do thất bại (nếu có)\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "default": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "default": 50
                        }
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "pending",
                                "processing",
                                "success",
                                "failed",
                                "cancelled",
                                "refunded"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "paymentMethod",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "vnpay",
                                "cash",
                                "other"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "fromDate",
                        "schema": {
                            "type": "string",
                            "format": "date-time"
                        }
                    },
                    {
                        "in": "query",
                        "name": "toDate",
                        "schema": {
                            "type": "string",
                            "format": "date-time"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy báo cáo thành công",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "message": {
                                            "type": "string"
                                        },
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "transactionId": {
                                                        "type": "string"
                                                    },
                                                    "transactionDate": {
                                                        "type": "string",
                                                        "format": "date-time"
                                                    },
                                                    "userName": {
                                                        "type": "string"
                                                    },
                                                    "userEmail": {
                                                        "type": "string"
                                                    },
                                                    "amount": {
                                                        "type": "number"
                                                    },
                                                    "currency": {
                                                        "type": "string"
                                                    },
                                                    "paymentMethod": {
                                                        "type": "string"
                                                    },
                                                    "status": {
                                                        "type": "string"
                                                    },
                                                    "description": {
                                                        "type": "string"
                                                    },
                                                    "failureReason": {
                                                        "type": "string"
                                                    },
                                                    "vnpayTransactionNo": {
                                                        "type": "string"
                                                    },
                                                    "bankCode": {
                                                        "type": "string"
                                                    },
                                                    "cardType": {
                                                        "type": "string"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    }
                }
            }
        },
        "/transactions": {
            "get": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Lấy danh sách giao dịch (admin/staff xem tất cả, user xem của mình)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "in": "query",
                        "name": "userId",
                        "schema": {
                            "type": "string"
                        },
                        "description": "Chỉ admin/staff mới có thể lọc theo userId"
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "paymentMethod",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy danh sách thành công"
                    }
                }
            },
            "post": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Tạo giao dịch mới (admin/staff only)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "userId",
                                    "amount",
                                    "paymentMethod"
                                ],
                                "properties": {
                                    "userId": {
                                        "type": "string"
                                    },
                                    "reservationId": {
                                        "type": "string"
                                    },
                                    "amount": {
                                        "type": "number"
                                    },
                                    "currency": {
                                        "type": "string",
                                        "default": "VND"
                                    },
                                    "status": {
                                        "type": "string",
                                        "enum": [
                                            "pending",
                                            "processing",
                                            "success",
                                            "failed",
                                            "cancelled",
                                            "refunded"
                                        ]
                                    },
                                    "paymentMethod": {
                                        "type": "string",
                                        "enum": [
                                            "vnpay",
                                            "cash",
                                            "other"
                                        ]
                                    },
                                    "description": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Tạo giao dịch thành công"
                    },
                    "400": {
                        "description": "Dữ liệu không hợp lệ"
                    }
                }
            }
        },
        "/transactions/{id}": {
            "get": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Lấy chi tiết giao dịch theo ID",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy chi tiết thành công"
                    },
                    "404": {
                        "description": "Không tìm thấy giao dịch"
                    }
                }
            }
        },
        "/transactions/stats/{userId}": {
            "get": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Lấy thống kê giao dịch của user bất kỳ (admin/staff only)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "userId",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy thống kê thành công"
                    },
                    "404": {
                        "description": "Không tìm thấy user"
                    }
                }
            }
        },
        "/transactions/report": {
            "get": {
                "tags": [
                    "Transactions"
                ],
                "summary": "Lấy báo cáo giao dịch chi tiết dạng bảng (admin/staff only)",
                "description": "Trả về bảng giao dịch với đầy đủ thông tin:\n- Ngày giao dịch\n- Tên người dùng + Email\n- Số tiền\n- Phương thức thanh toán\n- Trạng thái (success/failed/cancelled/pending)\n- Lý do thất bại (nếu có)\n- Mã giao dịch VNPay, ngân hàng, loại thẻ\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "default": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "default": 50
                        }
                    },
                    {
                        "in": "query",
                        "name": "userId",
                        "schema": {
                            "type": "string"
                        },
                        "description": "Lọc theo user ID"
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string"
                        },
                        "description": "Lọc theo trạng thái (có thể dùng dấu phẩy để lọc nhiều, vd success,failed)"
                    },
                    {
                        "in": "query",
                        "name": "paymentMethod",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "vnpay",
                                "cash",
                                "other"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "fromDate",
                        "schema": {
                            "type": "string",
                            "format": "date-time"
                        }
                    },
                    {
                        "in": "query",
                        "name": "toDate",
                        "schema": {
                            "type": "string",
                            "format": "date-time"
                        }
                    },
                    {
                        "in": "query",
                        "name": "sortBy",
                        "schema": {
                            "type": "string",
                            "default": "createdAt"
                        }
                    },
                    {
                        "in": "query",
                        "name": "sortOrder",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "asc",
                                "desc"
                            ],
                            "default": "desc"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Lấy báo cáo thành công"
                    },
                    "403": {
                        "description": "Không có quyền truy cập"
                    }
                }
            }
        },
        "/users/create": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Create a new user account",
                "description": "Registers a new user with **username, password, email, fullName** (required).\nOptional: **dob** (YYYY-MM-DD) and **address** (string or structured object).\nRole is always set to `user`.\n",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "username",
                                    "password",
                                    "email",
                                    "fullName"
                                ],
                                "properties": {
                                    "username": {
                                        "type": "string",
                                        "example": "bill"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "Sup3r$ecret!"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "bill@example.com"
                                    },
                                    "fullName": {
                                        "type": "string",
                                        "example": "Bill Bill"
                                    },
                                    "dob": {
                                        "type": "string",
                                        "format": "date",
                                        "example": "2000-01-31"
                                    },
                                    "address": {
                                        "oneOf": [
                                            {
                                                "type": "string",
                                                "example": "A12, Vinhomes Grand Park, TP. Thủ Đức"
                                            },
                                            {
                                                "type": "object",
                                                "properties": {
                                                    "line1": {
                                                        "type": "string",
                                                        "example": "A12, Vinhomes Grand Park"
                                                    },
                                                    "line2": {
                                                        "type": "string",
                                                        "example": "Block S5.02, Apt 15.08"
                                                    },
                                                    "ward": {
                                                        "type": "string",
                                                        "example": "Long Thạnh Mỹ"
                                                    },
                                                    "district": {
                                                        "type": "string",
                                                        "example": "TP. Thủ Đức"
                                                    },
                                                    "city": {
                                                        "type": "string",
                                                        "example": "Hồ Chí Minh"
                                                    },
                                                    "province": {
                                                        "type": "string",
                                                        "example": "Hồ Chí Minh"
                                                    },
                                                    "country": {
                                                        "type": "string",
                                                        "example": "VN"
                                                    },
                                                    "postalCode": {
                                                        "type": "string",
                                                        "example": "700000"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "User created"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "409": {
                        "description": "Username or Email already exists"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            }
        },
        "/users/login": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Login",
                "description": "Authenticates a user with **username** and **password** and returns a JWT token.",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "username",
                                    "password"
                                ],
                                "properties": {
                                    "username": {
                                        "type": "string",
                                        "example": "bill"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "Sup3r$ecret!"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Login successful"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Invalid credentials"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            }
        },
        "/users/profile": {
            "get": {
                "tags": [
                    "Users"
                ],
                "summary": "Get the authenticated user profile",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Profile retrieved"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            },
            "put": {
                "tags": [
                    "Users"
                ],
                "summary": "Update authenticated user profile",
                "description": "Requires JWT token. Roles allowed: admin, staff, user.\nCác field **đều tùy chọn**; chỉ field gửi lên mới được cập nhật.\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "username": {
                                        "type": "string",
                                        "example": "meomeo.new"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "meomeo.new@example.com"
                                    },
                                    "phone": {
                                        "type": "string",
                                        "example": "+84901234567"
                                    },
                                    "fullName": {
                                        "type": "string",
                                        "example": "Meo Meo"
                                    },
                                    "dob": {
                                        "oneOf": [
                                            {
                                                "type": "string",
                                                "format": "date",
                                                "example": "2001-02-01"
                                            },
                                            {
                                                "type": "null"
                                            }
                                        ]
                                    },
                                    "address": {
                                        "oneOf": [
                                            {
                                                "type": "string",
                                                "example": "A12, Vinhomes Grand Park"
                                            },
                                            {
                                                "type": "null"
                                            },
                                            {
                                                "type": "object",
                                                "properties": {
                                                    "line1": {
                                                        "type": "string"
                                                    },
                                                    "line2": {
                                                        "type": "string"
                                                    },
                                                    "ward": {
                                                        "type": "string"
                                                    },
                                                    "district": {
                                                        "type": "string"
                                                    },
                                                    "city": {
                                                        "type": "string"
                                                    },
                                                    "province": {
                                                        "type": "string"
                                                    },
                                                    "country": {
                                                        "type": "string"
                                                    },
                                                    "postalCode": {
                                                        "type": "string"
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Profile updated"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "409": {
                        "description": "Conflict (username/email already exists)"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            }
        },
        "/users/password": {
            "put": {
                "tags": [
                    "Users"
                ],
                "summary": "Change password (self)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "oldPassword",
                                    "newPassword"
                                ],
                                "properties": {
                                    "oldPassword": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "OldP@ssw0rd"
                                    },
                                    "newPassword": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "N3wP@ssw0rd!"
                                    },
                                    "confirmNewPassword": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "N3wP@ssw0rd!"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Password changed"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Old password incorrect / Unauthorized"
                    },
                    "404": {
                        "description": "User not found"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            }
        },
        "/users/get-all": {
            "get": {
                "tags": [
                    "Users"
                ],
                "summary": "List all users (admin only)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "403": {
                        "description": "Forbidden (not admin)"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            }
        },
        "/users/password/forgot": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Request password reset (send OTP + link)",
                "description": "Gửi email chứa OTP 6 số và liên kết đặt lại mật khẩu. Luôn trả 200 để tránh user enumeration.",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "email"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "user@example.com"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "If the email exists",
                        "an OTP and reset link have been sent": null
                    },
                    "400": {
                        "description": "Invalid email"
                    },
                    "500": {
                        "description": "Server error"
                    }
                }
            }
        },
        "/users/password/reset": {
            "post": {
                "tags": [
                    "Authentication"
                ],
                "summary": "Reset password with token or OTP (no uid)",
                "description": "Đặt lại mật khẩu bằng **email + token** hoặc **email + otp**.",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "user@example.com"
                                    },
                                    "token": {
                                        "type": "string",
                                        "description": "Reset token từ link (trong email)"
                                    },
                                    "otp": {
                                        "type": "string",
                                        "description": "OTP 6 số từ email",
                                        "example": "123456"
                                    },
                                    "newPassword": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "N3wP@ssw0rd!"
                                    },
                                    "confirmNewPassword": {
                                        "type": "string",
                                        "format": "password"
                                    }
                                },
                                "oneOf": [
                                    {
                                        "required": [
                                            "email",
                                            "token",
                                            "newPassword"
                                        ]
                                    },
                                    {
                                        "required": [
                                            "email",
                                            "otp",
                                            "newPassword"
                                        ]
                                    }
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Password has been reset"
                    },
                    "400": {
                        "description": "Invalid input or token/otp"
                    },
                    "404": {
                        "description": "User not found"
                    }
                }
            }
        },
        "/vehicles": {
            "post": {
                "tags": [
                    "Vehicles"
                ],
                "summary": "Create a vehicle",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "description": "- **User** role: owner will be forced to your own userId.\n- **Admin/Staff**: can specify `owner` or default to self.\n",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/VehicleCreate"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created"
                    },
                    "400": {
                        "description": "Validation error"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "409": {
                        "description": "plateNumber already exists"
                    }
                }
            },
            "get": {
                "tags": [
                    "Vehicles"
                ],
                "summary": "List vehicles (self for normal users; filterable for admin/staff)",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "description": "- **User** role: only your vehicles are returned.\n- **Admin/Staff**: can filter by any fields; omit `owner` to list across all users.\n",
                "parameters": [
                    {
                        "in": "query",
                        "name": "owner",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "plateNumber",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "active",
                                "inactive"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "type",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "car",
                                "motorbike",
                                "scooter",
                                "truck",
                                "other"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "example": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "example": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "401": {
                        "description": "Unauthorized"
                    }
                }
            }
        },
        "/vehicles/all": {
            "get": {
                "tags": [
                    "Vehicles"
                ],
                "summary": "(Admin/Staff) List ALL vehicles of ALL users",
                "description": "Chỉ admin/staff. Hỗ trợ filter `owner`, `plateNumber`, `status`, `type`, `page`, `limit`.\nNếu **không** truyền `owner` → trả về toàn bộ xe của mọi user.\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "query",
                        "name": "owner",
                        "schema": {
                            "type": "string"
                        },
                        "description": "Optional owner id to filter"
                    },
                    {
                        "in": "query",
                        "name": "plateNumber",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "in": "query",
                        "name": "status",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "active",
                                "inactive"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "type",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "car",
                                "motorbike",
                                "scooter",
                                "truck",
                                "other"
                            ]
                        }
                    },
                    {
                        "in": "query",
                        "name": "page",
                        "schema": {
                            "type": "integer",
                            "example": 1
                        }
                    },
                    {
                        "in": "query",
                        "name": "limit",
                        "schema": {
                            "type": "integer",
                            "example": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "403": {
                        "description": "Forbidden"
                    }
                }
            }
        },
        "/vehicles/{id}": {
            "get": {
                "tags": [
                    "Vehicles"
                ],
                "summary": "Get vehicle by id",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "403": {
                        "description": "Forbidden (not owner)"
                    },
                    "404": {
                        "description": "Not found"
                    }
                }
            },
            "put": {
                "tags": [
                    "Vehicles"
                ],
                "summary": "Update vehicle",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "$ref": "#/components/schemas/VehicleUpdate"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Updated"
                    },
                    "400": {
                        "description": "Validation error / No fields"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "403": {
                        "description": "Forbidden (not owner)"
                    },
                    "404": {
                        "description": "Not found"
                    },
                    "409": {
                        "description": "plateNumber exists"
                    }
                }
            },
            "delete": {
                "tags": [
                    "Vehicles"
                ],
                "summary": "Delete vehicle",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "parameters": [
                    {
                        "in": "path",
                        "name": "id",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Deleted"
                    },
                    "401": {
                        "description": "Unauthorized"
                    },
                    "403": {
                        "description": "Forbidden (not owner)"
                    },
                    "404": {
                        "description": "Not found"
                    }
                }
            }
        },
        "/vnpay/checkout-url": {
            "post": {
                "tags": [
                    "VNPay"
                ],
                "summary": "Tạo URL thanh toán VNPay (User chọn ngân hàng trên VNPay)",
                "description": "Tạo URL thanh toán VNPay. User sẽ được redirect đến trang VNPay \nđể chọn ngân hàng và phương thức thanh toán.\n\n**Các ngân hàng/phương thức có sẵn trên VNPay:**\n- ATM Card (Thẻ nội địa)\n- Internet Banking\n- Ví điện tử VNPay\n- QR Code\n- Visa/Mastercard/JCB\n\nUser sẽ tự chọn trên trang VNPay, không cần chọn trước.\n",
                "security": [
                    {
                        "bearerAuth": []
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "required": [
                                    "amount",
                                    "orderInfo"
                                ],
                                "properties": {
                                    "amount": {
                                        "type": "number",
                                        "example": 27716,
                                        "description": "Số tiền VND (sẽ *100 khi gửi lên VNPay)"
                                    },
                                    "orderInfo": {
                                        "type": "string",
                                        "example": "Thanh toan dat lich/hoa don #123",
                                        "description": "Thông tin đơn hàng hiển thị trên VNPay"
                                    },
                                    "reservationId": {
                                        "type": "string",
                                        "example": "60d5ec49f1b2c72b8c8e4f1a",
                                        "description": "ID của reservation - sẽ được dùng làm vnp_TxnRef"
                                    },
                                    "locale": {
                                        "type": "string",
                                        "enum": [
                                            "vn",
                                            "en"
                                        ],
                                        "example": "vn",
                                        "description": "Ngôn ngữ hiển thị trên VNPay (mặc định: vn)"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Tạo URL thanh toán thành công",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "message": {
                                            "type": "string"
                                        },
                                        "data": {
                                            "type": "object",
                                            "properties": {
                                                "paymentUrl": {
                                                    "type": "string",
                                                    "description": "URL để redirect user đến trang thanh toán VNPay"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Dữ liệu không hợp lệ"
                    },
                    "401": {
                        "description": "Chưa đăng nhập"
                    }
                }
            }
        },
        "/vnpay/check-payment-status": {
            "post": {
                "tags": [
                    "VNPay"
                ],
                "summary": "Kiểm tra trạng thái thanh toán từ VNPay return URL",
                "description": "API để kiểm tra trạng thái thanh toán dựa trên thông tin từ VNPay return URL.\nTrả về trạng thái rõ ràng: success, failed, cancelled.\nTự động cập nhật transaction và reservation status.\n",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "reservationId": {
                                        "type": "string",
                                        "description": "ID của reservation cần cập nhật (optional)",
                                        "example": "60d5ec49f1b2c72b8c8e4f1a"
                                    },
                                    "vnp_Amount": {
                                        "type": "string",
                                        "example": "2771600"
                                    },
                                    "vnp_BankCode": {
                                        "type": "string",
                                        "example": "NCB"
                                    },
                                    "vnp_BankTranNo": {
                                        "type": "string"
                                    },
                                    "vnp_CardType": {
                                        "type": "string",
                                        "example": "ATM"
                                    },
                                    "vnp_OrderInfo": {
                                        "type": "string"
                                    },
                                    "vnp_PayDate": {
                                        "type": "string",
                                        "example": "20251011172942"
                                    },
                                    "vnp_ResponseCode": {
                                        "type": "string",
                                        "example": "00"
                                    },
                                    "vnp_TmnCode": {
                                        "type": "string"
                                    },
                                    "vnp_TransactionNo": {
                                        "type": "string",
                                        "example": "15199015"
                                    },
                                    "vnp_TransactionStatus": {
                                        "type": "string",
                                        "example": "00"
                                    },
                                    "vnp_TxnRef": {
                                        "type": "string",
                                        "example": "ORDER-121"
                                    },
                                    "vnp_SecureHash": {
                                        "type": "string"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Kiểm tra thành công",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "success": {
                                            "type": "boolean"
                                        },
                                        "message": {
                                            "type": "string",
                                            "example": "Giao dịch thành công"
                                        },
                                        "paymentStatus": {
                                            "type": "string",
                                            "enum": [
                                                "success",
                                                "failed",
                                                "cancelled"
                                            ]
                                        },
                                        "data": {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string"
                                                },
                                                "isSuccess": {
                                                    "type": "boolean"
                                                },
                                                "vnpayInfo": {
                                                    "type": "object"
                                                },
                                                "transaction": {
                                                    "type": "object"
                                                },
                                                "reason": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "Dữ liệu không hợp lệ hoặc chữ ký sai"
                    }
                }
            }
        },
        "/vnpay/return": {
            "get": {
                "tags": [
                    "VNPay"
                ],
                "summary": "Return URL (client redirect) từ VNPay",
                "description": "VNPay sẽ redirect người dùng về URL này, kèm tham số ký số. Server xác minh chữ ký và trả JSON demo.",
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                }
            }
        },
        "/vnpay/ipn": {
            "get": {
                "tags": [
                    "VNPay"
                ],
                "summary": "IPN (server-to-server) từ VNPay",
                "description": "VNPay sẽ gọi URL này (không cần auth). Server xác minh chữ ký và phản hồi JSON với RspCode/Message.",
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                }
            }
        },
        "/health": {
            "get": {
                "tags": [
                    "System"
                ],
                "summary": "Kiểm tra tình trạng server"
            }
        },
        "/": {
            "get": {
                "tags": [
                    "System"
                ],
                "summary": "API Information"
            }
        }
    }
}